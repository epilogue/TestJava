<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz de Certification Java - Niveau Avanc√© (C1 √† C5)</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom Styles for better visual consistency */
        body {
            background-color: #e5e7eb; /* Gray-100 */
        }
        .container-quiz {
            max-width: 900px;
            margin: 2rem auto;
        }
        .competence-selector {
            background-color: #1f2937; /* Gray-800 */
        }
        .competence-btn.active {
            border-bottom: 3px solid #f97316; /* Orange-500 */
            color: #f97316;
        }
        .option-button {
            transition: all 0.2s;
        }
        .option-button:hover:not(.disabled) {
            background-color: #f3f4f6; /* Gray-100 */
        }
        .option-button.correct {
            background-color: #d1fae5; /* Green-100 */
            border-color: #10b981; /* Green-500 */
            pointer-events: none;
        }
        .option-button.incorrect {
            background-color: #fee2e2; /* Red-100 */
            border-color: #ef4444; /* Red-500 */
            pointer-events: none;
        }
        .explanation {
            border-left: 4px solid #f97316; /* Orange-500 */
        }
        pre {
            background-color: #f3f4f6;
            padding: 1rem;
            border-radius: 0.25rem;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>

<div class="container-quiz p-4">
    <h1 class="text-3xl font-extrabold text-center text-gray-800 mb-4">
        Quiz Avanc√© - Certification Java (C1 √† C5) üéì
    </h1>
    
    <div class="competence-selector p-3 rounded-t-lg shadow-lg flex flex-wrap justify-center space-x-2 sm:space-x-4">
        <button data-comp="0" class="competence-btn text-white px-3 py-2 text-sm font-medium border-b-3 border-transparent hover:text-orange-300 transition active">C1</button>
        <button data-comp="1" class="competence-btn text-white px-3 py-2 text-sm font-medium border-b-3 border-transparent hover:text-orange-300 transition">C2</button>
        <button data-comp="2" class="competence-btn text-white px-3 py-2 text-sm font-medium border-b-3 border-transparent hover:text-orange-300 transition">C3</button>
        <button data-comp="3" class="competence-btn text-white px-3 py-2 text-sm font-medium border-b-3 border-transparent hover:text-orange-300 transition">C4</button>
        <button data-comp="4" class="competence-btn text-white px-3 py-2 text-sm font-medium border-b-3 border-transparent hover:text-orange-300 transition">C5</button>
    </div>

    <div id="quiz-card" class="bg-white rounded-b-lg shadow-lg p-6 sm:p-8">
        </div>

    <div class="bg-white rounded-lg shadow p-4 text-sm text-gray-600 mt-6">
        <p class="font-semibold mb-2">üìã Informations sur le quiz :</p>
        <ul class="space-y-1">
            <li>‚Ä¢ Niveau de difficult√© : **Avanc√©**</li>
            <li>‚Ä¢ Chaque quiz contient **5 questions** (QCM/QCU) sp√©cifiques √† la comp√©tence.</li>
            <li>‚Ä¢ Score cumul√© total : <span id="final-score" class="font-bold text-orange-600"></span></li>
        </ul>
    </div>
</div>

<script>
    const quizData = [
        // --- C1 : √âl√©ments fondamentaux et algorithmie (Avanc√©) ---
        {
          competence: "C1 - √âl√©ments fondamentaux et algorithmie",
          level: "Avanc√©",
          questions: [
            {
              question: "Quel est le r√©sultat de l'op√©ration bit-√†-bit `int x = 5; int y = 3; int z = x & y;` ?",
              options: [
                "z vaut 1",
                "z vaut 2",
                "z vaut 7",
                "z vaut 15"
              ],
              correct: 0,
              explanation: "L'op√©rateur ET bit-√†-bit (`&`) compare les repr√©sentations binaires (5=101, 3=011). `101 & 011` donne `001`, ce qui correspond √† 1 en d√©cimal."
            },
            {
              question: "Si `String s1 = \"Java\";` et `String s2 = new String(\"Java\");`, que retourne `s1 == s2` ?",
              options: [
                "true",
                "false",
                "Le code ne compile pas",
                "Cela d√©pend de la version de la JVM"
              ],
              correct: 1,
              explanation: "L'op√©rateur `==` compare les r√©f√©rences (adresses m√©moire). `s1` r√©f√©rence un objet du pool de String, `s2` r√©f√©rence un nouvel objet cr√©√© sur le tas, donc les adresses sont diff√©rentes."
            },
            {
              question: "Dans le code `String.format(\"|%-10.2f|\", 123.456)`, quel sera le formatage de la sortie ?",
              options: [
                "|123.46    |",
                "|    123.46|",
                "|123.456   |",
                "|   123.456|"
              ],
              correct: 0,
              explanation: "Le flag `-` sp√©cifie l'alignement √† gauche, `10` la largeur totale et `.2f` arrondit le flottant √† deux d√©cimales."
            },
            {
              question: "Que se passe-t-il si vous tentez de modifier un tableau pass√© en param√®tre √† une m√©thode ?",
              options: [
                "La modification est impossible car le tableau est pass√© par valeur.",
                "Seule une copie du tableau est modifi√©e, l'original reste intact.",
                "Le tableau original est modifi√© car la r√©f√©rence au tableau est pass√©e par valeur.",
                "Une `IllegalAccessException` est lev√©e."
              ],
              correct: 2,
              explanation: "En Java, les objets (y compris les tableaux) sont pass√©s par r√©f√©rence (la r√©f√©rence est copi√©e). La m√©thode re√ßoit donc l'adresse de l'objet original et peut le modifier."
            },
            {
              question: "Lequel de ces algorithmes de tri a la meilleure complexit√© temporelle dans le pire des cas (Big O notation) ?",
              options: [
                "Tri √† bulles (Bubble Sort)",
                "Tri par s√©lection (Selection Sort)",
                "Tri par insertion (Insertion Sort)",
                "Tri fusion (Merge Sort)"
              ],
              correct: 3,
              explanation: "Le tri fusion (Merge Sort) a une complexit√© garantie de O(n log n) dans le pire des cas, tandis que les autres ont une complexit√© de O(n¬≤)."
            }
          ]
        },
        
        // --- C2 : Programmation Orient√©e Objet (Avanc√©) ---
        {
          competence: "C2 - Programmation Orient√©e Objet",
          level: "Avanc√©",
          questions: [
            {
              question: "Si une classe `Voiture` h√©rite de `Vehicule`, et que `v` est une variable de type `Vehicule` contenant une instance de `Voiture`, quel est le terme pour cette assignation `Vehicule v = new Voiture();` ?",
              options: [
                "Downcasting",
                "Upcasting (ou transtypage implicite)",
                "Autoboxing",
                "Polymorphisme statique"
              ],
              correct: 1,
              explanation: "L'upcasting est le processus de transtypage d'une instance de classe enfant vers son type de classe parent. C'est implicite et toujours s√ªr."
            },
            {
              question: "Pour garantir qu'une m√©thode ne puisse pas √™tre red√©finie (overridden) par une classe enfant, quel modificateur faut-il utiliser ?",
              options: [
                "`private`",
                "`static`",
                "`final`",
                "Tous les modificateurs ci-dessus l'emp√™chent."
              ],
              correct: 3,
              explanation: "`private` rend la m√©thode invisible √† la classe enfant, `static` la lie √† la classe et non √† l'instance (masquage, pas red√©finition), et `final` interdit explicitement la red√©finition."
            },
            {
              question: "Que se passe-t-il si vous n'appelez pas explicitement `super()` dans le constructeur d'une classe enfant ?",
              options: [
                "Le code ne compile pas.",
                "Le constructeur de la classe parent n'est jamais appel√©.",
                "Un appel implicite √† `super()` (le constructeur sans argument du parent) est ins√©r√© par le compilateur.",
                "Une `RuntimeException` est lev√©e √† l'ex√©cution."
              ],
              correct: 2,
              explanation: "Si le premier √©nonc√© d'un constructeur de classe enfant n'est pas un appel √† `this()` ou `super()`, le compilateur ins√®re automatiquement un appel au constructeur par d√©faut du parent (`super()`)."
            },
            {
              question: "Quel est le principal probl√®me si vous red√©finissez `equals()` sans red√©finir `hashCode()` ?",
              options: [
                "Le code ne compilera pas.",
                "Les comparaisons avec `==` √©choueront.",
                "Les collections bas√©es sur le hachage (comme `HashSet`, `HashMap`) ne fonctionneront pas correctement.",
                "La performance de l'application sera d√©grad√©e."
              ],
              correct: 2,
              explanation: "Le contrat entre `equals()` et `hashCode()` stipule que si deux objets sont √©gaux, ils doivent avoir le m√™me hash code. Si ce n'est pas le cas, un `HashSet` peut stocker des doublons (selon `equals()`)."
            },
            {
              question: "Lequel de ces design patterns est une alternative √† l'h√©ritage pour √©tendre les fonctionnalit√©s, favorisant la flexibilit√© ?",
              options: [
                "Singleton",
                "Factory",
                "Decorator (D√©corateur)",
                "Observer (Observateur)"
              ],
              correct: 2,
              explanation: "Le pattern D√©corateur permet d'ajouter dynamiquement des responsabilit√©s √† un objet en l'enveloppant, offrant une alternative flexible √† l'h√©ritage pour l'extension de fonctionnalit√©s."
            }
          ]
        },
        
        // --- C3 : Concepts avanc√©s POO (Avanc√©) ---
        {
          competence: "C3 - Concepts avanc√©s POO",
          level: "Avanc√©",
          questions: [
            {
              question: "Depuis Java 8, une `interface` peut contenir :",
              options: [
                "Uniquement des signatures de m√©thodes abstraites.",
                "Des signatures de m√©thodes, des constantes (`static final`) et des m√©thodes `default` et `static` avec corps.",
                "Des attributs d'instance.",
                "Des constructeurs."
              ],
              correct: 1,
              explanation: "Java 8 a introduit les m√©thodes `default` (qui peuvent √™tre red√©finies) et `static` (qui ne peuvent pas) dans les interfaces, leur permettant d'avoir un comportement concret."
            },
            {
              question: "√Ä quoi sert une 'functional interface' (interface fonctionnelle) ?",
              options: [
                "√Ä d√©finir une classe qui ne contient que des fonctions.",
                "√Ä marquer une interface qui peut √™tre utilis√©e dans un contexte de programmation fonctionnelle (ex: expressions lambda).",
                "√Ä garantir qu'une interface ne peut avoir qu'une seule impl√©mentation.",
                "√Ä forcer toutes les m√©thodes √† √™tre `static`."
              ],
              correct: 1,
              explanation: "Une interface fonctionnelle a une seule m√©thode abstraite et peut √™tre la cible d'une expression lambda ou d'une r√©f√©rence de m√©thode."
            },
            {
              question: "Quelle est la principale diff√©rence entre une `classe abstraite` et une `interface` en Java (apr√®s Java 8) ?",
              options: [
                "Une classe abstraite peut avoir un constructeur, une interface non.",
                "Une interface ne peut pas avoir de m√©thodes avec un corps.",
                "Une classe ne peut h√©riter que d'une seule classe abstraite, mais peut impl√©menter plusieurs interfaces.",
                "Les r√©ponses A et C sont correctes."
              ],
              correct: 3,
              explanation: "Les diff√©rences cl√©s restantes sont l'h√©ritage multiple (interfaces) et la capacit√© pour les classes abstraites d'avoir un √©tat (attributs d'instance) et des constructeurs."
            },
            {
              question: "Que signifie `throw new MonException(\"Erreur\", cause);` ?",
              options: [
                "Cr√©er une exception qui sera lanc√©e plus tard.",
                "Lancer une nouvelle exception et perdre l'information sur l'exception d'origine (`cause`).",
                "Lancer une nouvelle exception en conservant l'exception d'origine (`cause`) comme cause racine (cha√Ænage d'exceptions).",
                "D√©clarer que la m√©thode peut lancer `MonException`."
              ],
              correct: 2,
              explanation: "Le cha√Ænage d'exceptions est une pratique cruciale pour ne pas perdre la pile d'appels (stack trace) de l'erreur initiale lorsqu'on encapsule une exception bas niveau dans une exception m√©tier."
            },
            {
              question: "Si une √©num√©ration `Jour` a des constantes `LUNDI`, `MARDI`, etc., quelle m√©thode permet de r√©cup√©rer la constante `LUNDI` √† partir de la cha√Æne `\"LUNDI\"` ?",
              options: [
                "`Jour.get(\"LUNDI\")`",
                "`Jour.parse(\"LUNDI\")`",
                "`Jour.valueOf(\"LUNDI\")`",
                "`new Jour(\"LUNDI\")`"
              ],
              correct: 2,
              explanation: "La m√©thode statique `valueOf()` est automatiquement g√©n√©r√©e pour chaque √©num√©ration et permet de convertir une cha√Æne de caract√®res en une instance de l'√©num√©ration."
            }
          ]
        },
        
        // --- C4 : Collections, Streams et API de dates (Avanc√©) ---
        {
          competence: "C4 - Collections, Streams et API de dates",
          level: "Avanc√©",
          questions: [
            {
              question: "Quelle op√©ration terminale de l'API Stream permet de transformer un Stream en une `Map` ?",
              options: [
                "`collect(Collectors.toMap(keyMapper, valueMapper))`",
                "`map(k -> v)`",
                "`reduce(new HashMap(), ...)`",
                "`collect(Collectors.groupingBy(...))`"
              ],
              correct: 0,
              explanation: "`Collectors.toMap()` est le collecteur standard pour agr√©ger les √©l√©ments d'un flux dans une `Map`, en sp√©cifiant comment extraire la cl√© et la valeur de chaque √©l√©ment."
            },
            {
              question: "Comment calculer la dur√©e entre deux objets `LocalDateTime` en jours ?",
              options: [
                "`ChronoUnit.DAYS.between(start, end)`",
                "`Duration.ofDays(start, end)`",
                "`Period.between(start, end).getDays()`",
                "Ce n'est pas possible directement avec `LocalDateTime`."
              ],
              correct: 0,
              explanation: "La classe `ChronoUnit` fournit une m√©thode statique `between` pour calculer la dur√©e entre deux objets temporels dans une unit√© sp√©cifi√©e."
            },
            {
              question: "Quelle est la diff√©rence principale entre les op√©rations interm√©diaires `map()` et `flatMap()` dans un Stream ?",
              options: [
                "`map()` transforme chaque √©l√©ment, `flatMap()` les filtre.",
                "`map()` produit un Stream, `flatMap()` produit une Collection.",
                "`map()` applique une fonction 1-√†-1, `flatMap()` applique une fonction 1-√†-plusieurs et fusionne les r√©sultats.",
                "`flatMap()` est une version parall√©lis√©e de `map()`."
              ],
              correct: 2,
              explanation: "`flatMap()` est utilis√© pour transformer un √©l√©ment en un *Stream* d'autres √©l√©ments, puis tous ces sous-streams sont 'aplatis' en un seul stream r√©sultant."
            },
            {
              question: "Quel est le but de la classe `Optional` introduite en Java 8 ?",
              options: [
                "Rendre tous les attributs d'une classe optionnels.",
                "Remplacer toutes les exceptions par des valeurs optionnelles.",
                "Fournir un conteneur qui peut ou non contenir une valeur non-nulle, pour √©viter les `NullPointerException`.",
                "Optimiser la performance des Streams."
              ],
              correct: 2,
              explanation: "`Optional` est un type de retour qui force l'appelant √† consid√©rer explicitement le cas o√π une valeur est absente, am√©liorant la robustesse du code."
            },
            {
              question: "Dans l'API Stream, que fait l'op√©ration `reduce()` ?",
              options: [
                "Elle r√©duit le nombre d'√©l√©ments du Stream en en filtrant certains.",
                "Elle effectue une op√©ration d'agr√©gation sur les √©l√©ments du Stream pour produire un r√©sultat unique.",
                "Elle transforme chaque √©l√©ment en une version 'r√©duite' de lui-m√™me.",
                "Elle est un synonyme de `count()`."
              ],
              correct: 1,
              explanation: "L'op√©ration `reduce` combine les √©l√©ments d'un stream de mani√®re r√©p√©t√©e pour produire une valeur unique, comme une somme, une valeur maximale, ou une concat√©nation."
            }
          ]
        },
        
        // --- C5 : Connexion √† une base de donn√©es avec JDBC (Avanc√©) ---
        {
          competence: "C5 - Connexion √† une base de donn√©es avec JDBC",
          level: "Avanc√©",
          questions: [
            {
              question: "Quel est l'objectif principal d'un `Savepoint` dans une transaction JDBC ?",
              options: [
                "Valider (commit) une partie de la transaction.",
                "Cr√©er un point de sauvegarde pour permettre un rollback partiel.",
                "Sauvegarder l'√©tat de la base de donn√©es sur le disque.",
                "Acc√©l√©rer les transactions longues."
              ],
              correct: 1,
              explanation: "Un `Savepoint` permet d'annuler une partie d'une transaction (les op√©rations effectu√©es apr√®s le savepoint) sans annuler la transaction enti√®re."
            },
            {
              question: "Comment peut-on r√©cup√©rer l'ID auto-g√©n√©r√© apr√®s une requ√™te `INSERT` ?",
              options: [
                "En ex√©cutant une requ√™te `SELECT MAX(ID)` juste apr√®s.",
                "L'ID est retourn√© directement par la m√©thode `executeUpdate()`.",
                "En cr√©ant le `PreparedStatement` avec l'option `Statement.RETURN_GENERATED_KEYS` et en utilisant `getGeneratedKeys()`.",
                "Ce n'est pas possible avec JDBC standard."
              ],
              correct: 2,
              explanation: "L'option `RETURN_GENERATED_KEYS` indique au driver JDBC de retourner les cl√©s auto-incr√©ment√©es via un `ResultSet` sp√©cial accessible par `getGeneratedKeys()`."
            },
            {
              question: "Que se passe-t-il si vous appelez `close()` sur une `Connection` JDBC ?",
              options: [
                "Seul l'objet `Connection` est ferm√©, les `Statement` et `ResultSet` restent ouverts.",
                "Cela ferme la connexion et lib√®re imm√©diatement toutes les ressources JDBC associ√©es (Statement, ResultSet).",
                "Cela met la connexion en attente dans un pool de connexions.",
                "Cela valide (commit) automatiquement la transaction en cours avant de fermer."
              ],
              correct: 1,
              explanation: "La sp√©cification JDBC stipule que fermer une `Connection` doit √©galement fermer tous les `Statement` et `ResultSet` cr√©√©s √† partir d'elle."
            },
            {
              question: "Qu'est-ce qu'un niveau d'isolation de transaction comme `TRANSACTION_SERIALIZABLE` vise √† pr√©venir ?",
              options: [
                "Uniquement les lectures non reproductibles (non-repeatable reads).",
                "Uniquement les lectures fant√¥mes (phantom reads).",
                "Les lectures sales (dirty reads), les lectures non reproductibles et les lectures fant√¥mes.",
                "Les `SQLException`."
              ],
              correct: 2,
              explanation: "Le niveau `TRANSACTION_SERIALIZABLE` est le plus strict. Il emp√™che tous les types d'interf√©rences entre transactions concurrentes, garantissant une isolation compl√®te, mais au d√©triment de la performance."
            },
            {
              question: "Dans quel cas est-il plus performant d'utiliser `CallableStatement` plut√¥t que `PreparedStatement` ?",
              options: [
                "Pour ex√©cuter des requ√™tes `SELECT` complexes.",
                "Pour ex√©cuter des proc√©dures stock√©es (stored procedures) dans la base de donn√©es.",
                "Pour ex√©cuter des transactions.",
                "Il n'y a pas de diff√©rence de performance."
              ],
              correct: 1,
              explanation: "`CallableStatement` est une sous-interface de `PreparedStatement` sp√©cifiquement con√ßue pour appeler des proc√©dures stock√©es, qui sont pr√©-compil√©es c√¥t√© base de donn√©es et peuvent √™tre plus performantes."
            }
          ]
        }
    ];

    let currentCompetenceIndex = 0;
    let currentQuestionIndex = 0;
    let selectedAnswer = null;
    let showResult = false;
    // Stockage du score et des r√©ponses par comp√©tence: [score, reponse_index_selectionn√©_par_question]
    let quizState = quizData.map(comp => ({
        score: 0,
        answered: Array(comp.questions.length).fill(null), // null: non r√©pondu, -1: r√©ponse incorrecte, index: r√©ponse correcte
        isCompleted: false
    }));

    const quizCard = document.getElementById('quiz-card');
    const competenceButtons = document.querySelectorAll('.competence-btn');
    const finalScoreDisplay = document.getElementById('final-score');

    const TOTAL_QUESTIONS = quizData.reduce((sum, comp) => sum + comp.questions.length, 0);

    // --- Core Logic ---

    function updateFinalScoreDisplay() {
        const totalScore = quizState.reduce((sum, state) => sum + state.score, 0);
        finalScoreDisplay.textContent = `${totalScore}/${TOTAL_QUESTIONS} (${Math.round((totalScore / TOTAL_QUESTIONS) * 100)}%)`;
    }

    function checkAnswer(selectedIndex) {
        if (showResult) return; // Emp√™che de r√©pondre deux fois

        const currentCompState = quizState[currentCompetenceIndex];
        const currentQuestion = quizData[currentCompetenceIndex].questions[currentQuestionIndex];
        
        selectedAnswer = selectedIndex;
        showResult = true;

        // Mise √† jour de l'√©tat (score et r√©ponse)
        if (selectedIndex === currentQuestion.correct) {
            currentCompState.score++;
            currentCompState.answered[currentQuestionIndex] = selectedIndex; // Stocke l'index de la r√©ponse correcte
        } else {
             currentCompState.answered[currentQuestionIndex] = -1; // -1 pour incorrect
        }
        
        if (currentQuestionIndex === quizData[currentCompetenceIndex].questions.length - 1) {
            currentCompState.isCompleted = true;
        }

        renderQuiz();
        updateFinalScoreDisplay();
    }

    function nextQuestion() {
        showResult = false;
        selectedAnswer = null;
        
        const questionsInComp = quizData[currentCompetenceIndex].questions.length;

        if (currentQuestionIndex < questionsInComp - 1) {
            // Passer √† la question suivante dans la m√™me comp√©tence
            currentQuestionIndex++;
        } else {
            // Passer √† la comp√©tence suivante si la question actuelle est la derni√®re
            if (currentCompetenceIndex < quizData.length - 1) {
                currentCompetenceIndex++;
                currentQuestionIndex = 0;
                // Met √† jour l'√©tat des boutons de comp√©tence
                competenceButtons.forEach(btn => btn.classList.remove('active'));
                competenceButtons[currentCompetenceIndex].classList.add('active');
            } else {
                // Quiz enti√®rement termin√©
                return;
            }
        }
        renderQuiz();
    }
    
    function previousQuestion() {
        showResult = false;
        selectedAnswer = null;
        
        if (currentQuestionIndex > 0) {
            // Revenir √† la question pr√©c√©dente dans la m√™me comp√©tence
            currentQuestionIndex--;
        } else {
            // Revenir √† la comp√©tence pr√©c√©dente
            if (currentCompetenceIndex > 0) {
                currentCompetenceIndex--;
                currentQuestionIndex = quizData[currentCompetenceIndex].questions.length - 1;
                // Met √† jour l'√©tat des boutons de comp√©tence
                competenceButtons.forEach(btn => btn.classList.remove('active'));
                competenceButtons[currentCompetenceIndex].classList.add('active');
            } else {
                // Premi√®re question de la premi√®re comp√©tence
                return;
            }
        }
        
        // Si on revient √† une question d√©j√† r√©pondue, afficher la r√©ponse enregistr√©e
        const answeredState = quizState[currentCompetenceIndex].answered[currentQuestionIndex];
        if (answeredState !== null) {
            showResult = true;
            // Si la r√©ponse √©tait correcte, selectedAnswer doit √™tre l'index correct pour le rendu
            selectedAnswer = answeredState !== -1 ? answeredState : quizData[currentCompetenceIndex].questions[currentQuestionIndex].correct; 
        }

        renderQuiz();
    }

    function resetQuiz() {
        quizState = quizData.map(comp => ({
            score: 0,
            answered: Array(comp.questions.length).fill(null),
            isCompleted: false
        }));
        currentCompetenceIndex = 0;
        currentQuestionIndex = 0;
        selectedAnswer = null;
        showResult = false;
        competenceButtons.forEach(btn => btn.classList.remove('active'));
        competenceButtons[0].classList.add('active');
        renderQuiz();
        updateFinalScoreDisplay();
    }


    // --- Rendering Logic (HTML Generation) ---

    function renderQuiz() {
        const currentComp = quizData[currentCompetenceIndex];
        const currentQuestion = currentComp.questions[currentQuestionIndex];
        const questionsInComp = currentComp.questions.length;
        const compScore = quizState[currentCompetenceIndex].score;
        
        // V√©rifie si la question a √©t√© r√©pondue pour restaurer l'√©tat
        const answeredIndex = quizState[currentCompetenceIndex].answered[currentQuestionIndex];
        const isAnswered = answeredIndex !== null;
        
        if (isAnswered && !showResult) {
             showResult = true;
             // Si la r√©ponse √©tait incorrecte (-1), on affiche la bonne r√©ponse pour le rendu
             selectedAnswer = answeredIndex !== -1 ? answeredIndex : currentQuestion.correct;
        }

        let htmlContent = `
            <div class="mb-6">
                <h2 class="text-xl sm:text-2xl font-semibold text-orange-600 border-b pb-2 mb-4">
                    ${currentComp.competence} (Niveau ${currentComp.level})
                </h2>
                <div class="text-sm text-gray-500 mb-3 flex justify-between">
                    <p>Question ${currentQuestionIndex + 1}/${questionsInComp}</p>
                    <p>Score actuel pour C${currentCompetenceIndex + 1} : <span class="font-bold text-gray-800">${compScore}/5</span></p>
                </div>
                <div class="text-lg font-medium text-gray-900">${currentQuestion.question.includes('`') ? `<pre>${currentQuestion.question.replace(/`/g, '')}</pre>` : `<p>${currentQuestion.question}</p>`}</div>
            </div>

            <div class="space-y-3">
                ${currentQuestion.options.map((option, index) => {
                    let buttonClass = 'option-button p-3 border rounded-lg text-left w-full disabled:opacity-100';
                    let icon = '';

                    if (showResult) {
                        if (index === currentQuestion.correct) {
                            // Bonne r√©ponse
                            buttonClass += ' correct border-green-500 font-bold';
                            icon = '<span class="ml-auto text-green-600"><svg class="lucide-check-circle" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><path d="m9 11 3 3L22 4"></path></svg></span>';
                        } else if (index === selectedAnswer && selectedAnswer !== currentQuestion.correct) {
                            // Mauvaise r√©ponse s√©lectionn√©e
                            buttonClass += ' incorrect border-red-500';
                            icon = '<span class="ml-auto text-red-600"><svg class="lucide-x-circle" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="m15 9-6 6"></path><path d="m9 9 6 6"></path></svg></span>';
                        } else {
                            // Autres options non s√©lectionn√©es
                            buttonClass += ' bg-white text-gray-700';
                        }
                    } else {
                        // Pas encore r√©pondu
                        buttonClass += ' bg-white text-gray-700 hover:bg-gray-100';
                    }

                    return `
                        <button 
                            class="${buttonClass}" 
                            onclick="checkAnswer(${index})"
                            ${showResult ? 'disabled' : ''}
                        >
                            <span class="flex items-center justify-between">
                                <span>${option.includes('`') ? `<code>${option.replace(/`/g, '')}</code>` : option}</span>
                                ${icon}
                            </span>
                        </button>
                    `;
                }).join('')}
            </div>

            ${showResult ? `
                <div class="mt-6 p-4 explanation bg-orange-50 rounded-lg text-gray-700">
                    <p class="font-semibold text-orange-700 mb-1">Explication :</p>
                    <p>${currentQuestion.explanation}</p>
                </div>
            ` : ''}
            
            <div class="mt-8 flex justify-between items-center">
                <button
                    onclick="previousQuestion()"
                    class="flex items-center gap-2 px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors ${currentCompetenceIndex === 0 && currentQuestionIndex === 0 ? 'opacity-50 cursor-not-allowed' : ''}"
                    ${currentCompetenceIndex === 0 && currentQuestionIndex === 0 ? 'disabled' : ''}
                >
                    <svg class="lucide-chevron-left" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg>
                    Pr√©c√©dent
                </button>
                
                ${!showResult ? `
                    <p class="text-sm text-gray-500">S√©lectionnez une option</p>
                ` : `
                    <button
                        onclick="nextQuestion()"
                        class="flex items-center gap-2 px-6 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors"
                    >
                        Suivant
                        <svg class="lucide-chevron-right" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"></path></svg>
                    </button>
                `}
            </div>
            
            ${currentCompetenceIndex === quizData.length - 1 && currentQuestionIndex === questionsInComp - 1 && showResult ? `
                 <div class="mt-8 pt-4 border-t border-gray-200 text-center">
                    <p class="text-xl font-bold text-orange-900 mb-2">
                        Fin du Quiz Avanc√© !
                    </p>
                    <button
                        onclick="resetQuiz()"
                        class="flex items-center mx-auto gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"
                    >
                        <svg class="lucide-rotate-ccw" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6H9M10 20l-4-4 4-4"></path><path d="M4 16h13a4 4 0 0 0 0-8h-2"></path></svg>
                        Recommencer tous les quiz
                    </button>
                </div>
            ` : ''}
        `;

        quizCard.innerHTML = htmlContent;
    }

    function changeCompetence(index) {
        currentCompetenceIndex = index;
        currentQuestionIndex = 0;
        selectedAnswer = null;
        showResult = false;
        
        // G√®re l'√©tat des boutons
        competenceButtons.forEach((btn, i) => {
            btn.classList.toggle('active', i === index);
        });

        // Tente de charger la premi√®re question de la comp√©tence
        const answeredIndex = quizState[currentCompetenceIndex].answered[currentQuestionIndex];
        if (answeredIndex !== null) {
            showResult = true;
            selectedAnswer = answeredIndex !== -1 ? answeredIndex : quizData[currentCompetenceIndex].questions[currentQuestionIndex].correct; 
        }

        renderQuiz();
    }
    
    // --- Initialization ---
    competenceButtons.forEach((btn, index) => {
        btn.addEventListener('click', () => changeCompetence(index));
    });

    // Rendu initial
    renderQuiz();
    updateFinalScoreDisplay();
</script>
</body>
</html>
