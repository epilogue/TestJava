<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz de Certification Java - Niveau Interm√©diaire (C1 √† C5)</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom Styles for better visual consistency */
        body {
            background-color: #e5e7eb; /* Gray-100 */
        }
        .container-quiz {
            max-width: 900px;
            margin: 2rem auto;
        }
        .competence-selector {
            background-color: #1f2937; /* Gray-800 */
        }
        .competence-btn.active {
            border-bottom: 3px solid #f97316; /* Orange-500 */
            color: #f97316;
        }
        .option-button {
            transition: all 0.2s;
        }
        .option-button:hover:not(.disabled) {
            background-color: #f3f4f6; /* Gray-100 */
        }
        .option-button.correct {
            background-color: #d1fae5; /* Green-100 */
            border-color: #10b981; /* Green-500 */
            pointer-events: none;
        }
        .option-button.incorrect {
            background-color: #fee2e2; /* Red-100 */
            border-color: #ef4444; /* Red-500 */
            pointer-events: none;
        }
        .explanation {
            border-left: 4px solid #f97316; /* Orange-500 */
        }
    </style>
</head>
<body>

<div class="container-quiz p-4">
    <h1 class="text-3xl font-extrabold text-center text-gray-800 mb-4">
        Quiz Interm√©diaire - Certification Java (C1 √† C5) üéì
    </h1>
    
    <div class="competence-selector p-3 rounded-t-lg shadow-lg flex flex-wrap justify-center space-x-2 sm:space-x-4">
        <button data-comp="0" class="competence-btn text-white px-3 py-2 text-sm font-medium border-b-3 border-transparent hover:text-orange-300 transition active">C1</button>
        <button data-comp="1" class="competence-btn text-white px-3 py-2 text-sm font-medium border-b-3 border-transparent hover:text-orange-300 transition">C2</button>
        <button data-comp="2" class="competence-btn text-white px-3 py-2 text-sm font-medium border-b-3 border-transparent hover:text-orange-300 transition">C3</button>
        <button data-comp="3" class="competence-btn text-white px-3 py-2 text-sm font-medium border-b-3 border-transparent hover:text-orange-300 transition">C4</button>
        <button data-comp="4" class="competence-btn text-white px-3 py-2 text-sm font-medium border-b-3 border-transparent hover:text-orange-300 transition">C5</button>
    </div>

    <div id="quiz-card" class="bg-white rounded-b-lg shadow-lg p-6 sm:p-8">
        </div>

    <div class="bg-white rounded-lg shadow p-4 text-sm text-gray-600 mt-6">
        <p class="font-semibold mb-2">üìã Informations sur le quiz :</p>
        <ul class="space-y-1">
            <li>‚Ä¢ Niveau de difficult√© : **Interm√©diaire**</li>
            <li>‚Ä¢ Chaque quiz contient **5 questions** (QCM/QCU) sp√©cifiques √† la comp√©tence.</li>
            <li>‚Ä¢ Score cumul√© total : <span id="final-score" class="font-bold text-orange-600"></span></li>
        </ul>
    </div>
</div>

<script>
    const quizData = [
        // --- C1 : √âl√©ments fondamentaux et algorithmie (Interm√©diaire) ---
        {
          competence: "C1 - √âl√©ments fondamentaux et algorithmie",
          level: "Interm√©diaire",
          questions: [
            {
              question: "Quel est le r√©sultat de l'op√©ration `int x = 5; int y = x++ * 2;` ?",
              options: [
                "`x` vaut 6, `y` vaut 10",
                "`x` vaut 6, `y` vaut 12",
                "`x` vaut 5, `y` vaut 10",
                "Le code ne compile pas"
              ],
              correct: 0,
              explanation: "L'op√©rateur post-incr√©mentation `x++` utilise d'abord la valeur de `x` (5) pour le calcul, puis incr√©mente `x`."
            },
            {
              question: "Quelle est la principale diff√©rence entre `String` et `StringBuilder` ?",
              options: [
                "`String` est plus rapide pour la concat√©nation.",
                "`StringBuilder` est immuable (immutable).",
                "`String` cr√©e un nouvel objet √† chaque modification, `StringBuilder` modifie l'objet existant.",
                "Il n'y a pas de diff√©rence fonctionnelle."
              ],
              correct: 2,
              explanation: "`String` est immuable, ce qui signifie que chaque concat√©nation cr√©e une nouvelle instance en m√©moire. `StringBuilder` est mutable, ce qui le rend plus efficace pour des modifications multiples."
            },
            {
              question: "Que fait l'instruction `break maBoucle;` dans des boucles imbriqu√©es ?",
              options: [
                "Elle termine uniquement la boucle la plus interne.",
                "Elle termine la boucle externe identifi√©e par le label `maBoucle`.",
                "Elle saute l'it√©ration en cours de la boucle externe.",
                "Ceci est une syntaxe invalide en Java."
              ],
              correct: 1,
              explanation: "Un `break` avec un label permet de sortir d'une structure de boucle ou de bloc sp√©cifique, autre que la plus interne."
            },
            {
              question: "Comment d√©clare-t-on un tableau 2D irr√©gulier (jagged array) o√π la premi√®re ligne a 3 colonnes et la seconde en a 2 ?",
              options: [
                "`int[][] tab = new int[2][3,2];`",
                "`int[][] tab = new int[2][]; tab[0] = new int[3]; tab[1] = new int[2];`",
                "`int[2][*] tab = { {1,2,3}, {4,5} };`",
                "Ce n'est pas possible en Java."
              ],
              correct: 1,
              explanation: "Pour un tableau irr√©gulier, on ne sp√©cifie que la taille de la premi√®re dimension, puis on alloue chaque sous-tableau individuellement."
            },
            {
              question: "L'op√©rateur `^` en Java est utilis√© pour :",
              options: [
                "L'exponentiation (puissance).",
                "Le OU exclusif (XOR) bit-√†-bit.",
                "La concat√©nation de cha√Ænes.",
                "Le ET logique (AND)."
              ],
              correct: 1,
              explanation: "L'op√©rateur `^` effectue une op√©ration binaire XOR, qui retourne 1 si les bits compar√©s sont diff√©rents, et 0 sinon."
            }
          ]
        },
        
        // --- C2 : Programmation Orient√©e Objet (Interm√©diaire) ---
        {
          competence: "C2 - Programmation Orient√©e Objet",
          level: "Interm√©diaire",
          questions: [
            {
              question: "Quelle est la diff√©rence fondamentale entre la surcharge (overloading) et la red√©finition (overriding) de m√©thode ?",
              options: [
                "La surcharge se fait dans la classe enfant, la red√©finition dans la m√™me classe.",
                "La surcharge change la signature de la m√©thode, la red√©finition la conserve.",
                "La red√©finition utilise le mot-cl√© `static`, la surcharge non.",
                "Il n'y a pas de diff√©rence majeure."
              ],
              correct: 1,
              explanation: "La surcharge (overloading) a le m√™me nom de m√©thode mais des param√®tres diff√©rents. La red√©finition (overriding) a la m√™me signature (nom et param√®tres) et se produit dans une classe enfant."
            },
            {
              question: "Que signifie le mot-cl√© `final` lorsqu'il est appliqu√© √† une classe ?",
              options: [
                "La classe ne peut pas √™tre instanci√©e.",
                "Toutes les m√©thodes de la classe deviennent finales.",
                "La classe ne peut pas avoir de classe enfant (on ne peut pas en h√©riter).",
                "La classe ne peut contenir que des constantes."
              ],
              correct: 2,
              explanation: "Le modificateur `final` sur une classe emp√™che l'h√©ritage, ce qui garantit que son impl√©mentation ne sera pas modifi√©e par une sous-classe."
            },
            {
              question: "Dans le constructeur d'une classe enfant, quel est le r√¥le de `super()` ?",
              options: [
                "Appeler une m√©thode statique de la classe parent.",
                "Appeler le constructeur de la classe parent.",
                "Cr√©er une instance de la classe parent.",
                "R√©f√©rencer un attribut de la classe parent."
              ],
              correct: 1,
              explanation: "L'appel `super()` dans un constructeur de classe enfant invoque le constructeur correspondant de la classe m√®re pour initialiser la partie h√©rit√©e de l'objet."
            },
            {
              question: "Une m√©thode `static` peut-elle acc√©der directement √† un attribut d'instance (non-statique) ?",
              options: [
                "Oui, sans aucune restriction.",
                "Oui, mais seulement si l'attribut est `public`.",
                "Non, car une m√©thode statique n'est pas li√©e √† une instance sp√©cifique.",
                "Seulement si la m√©thode est aussi `final`."
              ],
              correct: 2,
              explanation: "Les m√©thodes statiques appartiennent √† la classe, pas √† une instance. Elles n'ont pas de 'this' et ne peuvent donc pas acc√©der aux attributs qui d√©pendent d'une instance."
            },
            {
              question: "Lequel de ces sc√©narios est un exemple de 'composition' plut√¥t que d''h√©ritage' ?",
              options: [
                "Une `Voiture` est un `Vehicule`.",
                "Un `Manager` est un `Employe`.",
                "Une `Voiture` a un `Moteur`.",
                "Un `Cercle` est une `Forme`."
              ],
              correct: 2,
              explanation: "La composition (relation 'a-un') consiste √† inclure un objet d'une autre classe comme attribut. L'h√©ritage (relation 'est-un') cr√©e une hi√©rarchie de types."
            }
          ]
        },
        
        // --- C3 : Structures de Contr√¥le, Tableaux et Collections (Interm√©diaire) ---
        {
          competence: "C3 - Structures de Contr√¥le, Tableaux et Collections",
          level: "Interm√©diaire",
          questions: [
            {
              question: "Quelle est la principale diff√©rence de performance entre un `ArrayList` et un `LinkedList` ?",
              options: [
                "`ArrayList` est plus rapide pour les insertions/suppressions au milieu de la liste.",
                "`LinkedList` est plus rapide pour l'acc√®s par index (`get(i)`).",
                "`ArrayList` est plus rapide pour l'acc√®s par index, `LinkedList` pour les insertions/suppressions.",
                "Il n'y a pas de diff√©rence de performance significative."
              ],
              correct: 2,
              explanation: "`ArrayList` utilise un tableau interne, ce qui rend l'acc√®s par index tr√®s rapide (O(1)), mais les insertions/suppressions co√ªteuses (O(n)). `LinkedList` utilise des n≈ìuds li√©s, ce qui inverse ces caract√©ristiques."
            },
            {
              question: "Que se passe-t-il si vous essayez d'ajouter un √©l√©ment d√©j√† existant √† un `HashSet` ?",
              options: [
                "Une exception est lev√©e.",
                "L'√©l√©ment est ajout√© une deuxi√®me fois.",
                "L'op√©ration est ignor√©e et la collection reste inchang√©e.",
                "L'ancien √©l√©ment est remplac√© par le nouveau."
              ],
              correct: 2,
              explanation: "Un `Set` ne peut pas contenir de doublons. La m√©thode `add()` retourne `false` et l'ensemble n'est pas modifi√© si l'√©l√©ment est d√©j√† pr√©sent (bas√© sur `equals()` et `hashCode()`)."
            },
            {
              question: "Dans une `HashMap<K, V>`, que doit garantir la classe utilis√©e pour la cl√© `K` ?",
              options: [
                "Elle doit impl√©menter l'interface `Comparable`.",
                "Elle doit avoir une m√©thode `toString()` valide.",
                "Elle doit correctement red√©finir `equals()` et `hashCode()`.",
                "Elle doit √™tre `final`."
              ],
              correct: 2,
              explanation: "Pour que la `HashMap` fonctionne correctement (trouver des cl√©s, √©viter les doublons), elle doit pouvoir comparer les cl√©s de mani√®re fiable, ce qui n√©cessite des impl√©mentations coh√©rentes de `equals()` et `hashCode()`."
            },
            {
              question: "Quelle est une limitation de la boucle `for-each` (`for (Type element : collection)`) ?",
              options: [
                "Elle ne peut pas √™tre utilis√©e avec des tableaux.",
                "Elle ne permet pas de supprimer des √©l√©ments de la collection pendant l'it√©ration.",
                "Elle est plus lente qu'une boucle `for` classique.",
                "Elle ne peut pas acc√©der √† l'index de l'√©l√©ment courant."
              ],
              correct: 3,
              explanation: "La boucle `for-each` abstrait l'index et ne fournit qu'un acc√®s direct √† l'√©l√©ment. Pour obtenir l'index, une boucle `for` traditionnelle est n√©cessaire."
            },
            {
              question: "√Ä partir de Java 14, comment peut-on simplifier une instruction `switch` pour retourner une valeur ?",
              options: [
                "En utilisant le mot-cl√© `return` dans chaque `case`.",
                "En utilisant la syntaxe 'arrow' (`->`) et `yield` (ou une expression).",
                "Ce n'est pas possible, un `switch` ne retourne pas de valeur.",
                "En utilisant un `if` √† l'int√©rieur du `switch`."
              ],
              correct: 1,
              explanation: "Les 'switch expressions' introduites dans les versions r√©centes de Java permettent une syntaxe plus concise pour retourner des valeurs, en √©vitant les `break` et les variables temporaires."
            }
          ]
        },
        
        // --- C4 : Gestion des Exceptions et Entr√©es/Sorties (Interm√©diaire) ---
        {
          competence: "C4 - Gestion des Exceptions et Entr√©es/Sorties (I/O)",
          level: "Interm√©diaire",
          questions: [
            {
              question: "Quel est l'avantage principal de la syntaxe `try-with-resources` ?",
              options: [
                "Elle permet de capturer plusieurs types d'exceptions.",
                "Elle garantit la fermeture automatique des ressources `AutoCloseable`.",
                "Elle est plus rapide √† l'ex√©cution qu'un `try-catch-finally`.",
                "Elle permet de relancer une exception sans la d√©clarer."
              ],
              correct: 1,
              explanation: "`try-with-resources` simplifie la gestion des ressources en assurant que leur m√©thode `close()` est appel√©e, √©vitant ainsi les fuites de ressources."
            },
            {
              question: "Quelle est la diff√©rence entre `throw` et `throws` en Java ?",
              options: [
                "`throw` est utilis√© pour les exceptions non v√©rifi√©es, `throws` pour les v√©rifi√©es.",
                "`throw` est utilis√© pour lancer une exception, `throws` pour d√©clarer qu'une m√©thode peut en lancer une.",
                "`throws` est plac√© √† l'int√©rieur d'une m√©thode, `throw` dans sa signature.",
                "Il n'y a pas de diff√©rence, ils sont interchangeables."
              ],
              correct: 1,
              explanation: "`throw` est l'instruction qui lance une instance d'exception. `throws` fait partie de la signature d'une m√©thode et avertit les appelants qu'ils doivent g√©rer cette exception."
            },
            {
              question: "Pour cr√©er une exception personnalis√©e qui doit obligatoirement √™tre g√©r√©e (Checked Exception), de quelle classe doit-elle h√©riter ?",
              options: [
                "`RuntimeException`",
                "`Error`",
                "`Exception` (ou une de ses sous-classes sauf `RuntimeException`)",
                "`Throwable`"
              ],
              correct: 2,
              explanation: "H√©riter de `Exception` (ou `IOException`, etc.) cr√©e une exception v√©rifi√©e, for√ßant l'appelant √† l'attraper avec `try-catch` ou √† la propager avec `throws`."
            },
            {
              question: "Quelle classe est la plus efficace pour lire un gros fichier texte ligne par ligne ?",
              options: [
                "`FileInputStream`",
                "`FileReader`",
                "`BufferedReader` enveloppant un `FileReader`",
                "`Scanner`"
              ],
              correct: 2,
              explanation: "`BufferedReader` utilise un tampon (buffer) pour lire de gros blocs de donn√©es √† la fois, ce qui minimise les acc√®s au disque et am√©liore consid√©rablement les performances."
            },
            {
              question: "Que permet la syntaxe `catch (IOException | SQLException e)` ?",
              options: [
                "De capturer `IOException` puis, si elle √©choue, de capturer `SQLException`.",
                "De capturer n'importe quelle exception qui h√©rite √† la fois de `IOException` et `SQLException`.",
                "De capturer soit `IOException`, soit `SQLException` dans un seul bloc de code.",
                "C'est une syntaxe invalide."
              ],
              correct: 2,
              explanation: "Le 'multi-catch', introduit en Java 7, permet de g√©rer plusieurs types d'exceptions avec un seul bloc `catch`, r√©duisant ainsi la duplication de code."
            }
          ]
        },
        
        // --- C5 : Connexion √† une base de donn√©es avec JDBC (Interm√©diaire) ---
        {
          competence: "C5 - Connexion √† une base de donn√©es avec JDBC",
          level: "Interm√©diaire",
          questions: [
            {
              question: "Pourquoi `PreparedStatement` est-il g√©n√©ralement pr√©f√©r√© √† `Statement` ?",
              options: [
                "Il est plus simple √† √©crire.",
                "Il prot√®ge contre les injections SQL et peut √™tre plus performant.",
                "Il permet d'ex√©cuter plusieurs types de requ√™tes √† la fois.",
                "Il ne l√®ve jamais de `SQLException`."
              ],
              correct: 1,
              explanation: "`PreparedStatement` pr√©-compile la requ√™te et traite les param√®tres comme des donn√©es, ce qui emp√™che les injections SQL. Il peut aussi √™tre mis en cache par le SGBD, am√©liorant les performances."
            },
            {
              question: "Que signifie `conn.setAutoCommit(false);` ?",
              options: [
                "La connexion ne sera jamais valid√©e.",
                "Chaque requ√™te sera valid√©e manuellement avec `conn.commit()` ou annul√©e avec `conn.rollback()`.",
                "La connexion est en mode lecture seule.",
                "La base de donn√©es g√©rera les transactions automatiquement."
              ],
              correct: 1,
              explanation: "D√©sactiver l'auto-commit est la premi√®re √©tape pour g√©rer une transaction manuellement, permettant de grouper plusieurs op√©rations en une seule unit√© atomique."
            },
            {
              question: "Pour pouvoir se d√©placer librement (en avant et en arri√®re) dans un `ResultSet`, comment doit √™tre cr√©√© le `Statement` ?",
              options: [
                "`conn.createStatement()`",
                "`conn.createStatement(ResultSet.TYPE_FORWARD_ONLY, ResultSet.CONCUR_READ_ONLY)`",
                "`conn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY)`",
                "Tous les `ResultSet` sont d√©pla√ßables par d√©faut."
              ],
              correct: 2,
              explanation: "Pour cr√©er un `ResultSet` 'scrollable', il faut sp√©cifier un type comme `TYPE_SCROLL_INSENSITIVE` ou `TYPE_SCROLL_SENSITIVE` lors de la cr√©ation du `Statement`."
            },
            {
              question: "Quel est le but de la m√©thode `executeBatch()` sur un `PreparedStatement` ?",
              options: [
                "Ex√©cuter une seule requ√™te qui affecte plusieurs tables.",
                "Envoyer un groupe de requ√™tes (ajout√©es avec `addBatch()`) √† la base de donn√©es en un seul appel.",
                "Valider une transaction (commit).",
                "Ex√©cuter des requ√™tes en parall√®le."
              ],
              correct: 1,
              explanation: "Le traitement par lots (batch processing) est une optimisation qui r√©duit le nombre d'allers-retours r√©seau en envoyant plusieurs commandes SQL en une seule fois."
            },
            {
              question: "En plus de `getMessage()`, quelle autre m√©thode de `SQLException` est utile pour obtenir un code d'erreur standardis√© ?",
              options: [
                "`getErrorCode()`",
                "`getSQLState()`",
                "`getErrorType()`",
                "`getStandardCode()`"
              ],
              correct: 1,
              explanation: "`getSQLState()` retourne un code d'erreur standardis√© (SQLSTATE) sur 5 caract√®res, ind√©pendant du fournisseur de la base de donn√©es, contrairement √† `getErrorCode()` qui est sp√©cifique."
            }
          ]
        }
    ];

    let currentCompetenceIndex = 0;
    let currentQuestionIndex = 0;
    let selectedAnswer = null;
    let showResult = false;
    // Stockage du score et des r√©ponses par comp√©tence: [score, reponse_index_selectionn√©_par_question]
    let quizState = quizData.map(comp => ({
        score: 0,
        answered: Array(comp.questions.length).fill(null), // null: non r√©pondu, -1: r√©ponse incorrecte, index: r√©ponse correcte
        isCompleted: false
    }));

    const quizCard = document.getElementById('quiz-card');
    const competenceButtons = document.querySelectorAll('.competence-btn');
    const finalScoreDisplay = document.getElementById('final-score');

    const TOTAL_QUESTIONS = quizData.reduce((sum, comp) => sum + comp.questions.length, 0);

    // --- Core Logic ---

    function updateFinalScoreDisplay() {
        const totalScore = quizState.reduce((sum, state) => sum + state.score, 0);
        finalScoreDisplay.textContent = `${totalScore}/${TOTAL_QUESTIONS} (${Math.round((totalScore / TOTAL_QUESTIONS) * 100)}%)`;
    }

    function checkAnswer(selectedIndex) {
        if (showResult) return; // Emp√™che de r√©pondre deux fois

        const currentCompState = quizState[currentCompetenceIndex];
        const currentQuestion = quizData[currentCompetenceIndex].questions[currentQuestionIndex];
        
        selectedAnswer = selectedIndex;
        showResult = true;

        // Mise √† jour de l'√©tat (score et r√©ponse)
        if (selectedIndex === currentQuestion.correct) {
            currentCompState.score++;
            currentCompState.answered[currentQuestionIndex] = selectedIndex; // Stocke l'index de la r√©ponse correcte
        } else {
             currentCompState.answered[currentQuestionIndex] = -1; // -1 pour incorrect
        }
        
        if (currentQuestionIndex === quizData[currentCompetenceIndex].questions.length - 1) {
            currentCompState.isCompleted = true;
        }

        renderQuiz();
        updateFinalScoreDisplay();
    }

    function nextQuestion() {
        showResult = false;
        selectedAnswer = null;
        
        const questionsInComp = quizData[currentCompetenceIndex].questions.length;

        if (currentQuestionIndex < questionsInComp - 1) {
            // Passer √† la question suivante dans la m√™me comp√©tence
            currentQuestionIndex++;
        } else {
            // Passer √† la comp√©tence suivante si la question actuelle est la derni√®re
            if (currentCompetenceIndex < quizData.length - 1) {
                currentCompetenceIndex++;
                currentQuestionIndex = 0;
                // Met √† jour l'√©tat des boutons de comp√©tence
                competenceButtons.forEach(btn => btn.classList.remove('active'));
                competenceButtons[currentCompetenceIndex].classList.add('active');
            } else {
                // Quiz enti√®rement termin√©
                return;
            }
        }
        renderQuiz();
    }
    
    function previousQuestion() {
        showResult = false;
        selectedAnswer = null;
        
        if (currentQuestionIndex > 0) {
            // Revenir √† la question pr√©c√©dente dans la m√™me comp√©tence
            currentQuestionIndex--;
        } else {
            // Revenir √† la comp√©tence pr√©c√©dente
            if (currentCompetenceIndex > 0) {
                currentCompetenceIndex--;
                currentQuestionIndex = quizData[currentCompetenceIndex].questions.length - 1;
                // Met √† jour l'√©tat des boutons de comp√©tence
                competenceButtons.forEach(btn => btn.classList.remove('active'));
                competenceButtons[currentCompetenceIndex].classList.add('active');
            } else {
                // Premi√®re question de la premi√®re comp√©tence
                return;
            }
        }
        
        // Si on revient √† une question d√©j√† r√©pondue, afficher la r√©ponse enregistr√©e
        const answeredState = quizState[currentCompetenceIndex].answered[currentQuestionIndex];
        if (answeredState !== null) {
            showResult = true;
            // Si la r√©ponse √©tait correcte, selectedAnswer doit √™tre l'index correct pour le rendu
            selectedAnswer = answeredState !== -1 ? answeredState : quizData[currentCompetenceIndex].questions[currentQuestionIndex].correct; 
        }

        renderQuiz();
    }

    function resetQuiz() {
        quizState = quizData.map(comp => ({
            score: 0,
            answered: Array(comp.questions.length).fill(null),
            isCompleted: false
        }));
        currentCompetenceIndex = 0;
        currentQuestionIndex = 0;
        selectedAnswer = null;
        showResult = false;
        competenceButtons.forEach(btn => btn.classList.remove('active'));
        competenceButtons[0].classList.add('active');
        renderQuiz();
        updateFinalScoreDisplay();
    }


    // --- Rendering Logic (HTML Generation) ---

    function renderQuiz() {
        const currentComp = quizData[currentCompetenceIndex];
        const currentQuestion = currentComp.questions[currentQuestionIndex];
        const questionsInComp = currentComp.questions.length;
        const compScore = quizState[currentCompetenceIndex].score;
        
        // V√©rifie si la question a √©t√© r√©pondue pour restaurer l'√©tat
        const answeredIndex = quizState[currentCompetenceIndex].answered[currentQuestionIndex];
        const isAnswered = answeredIndex !== null;
        
        if (isAnswered && !showResult) {
             showResult = true;
             // Si la r√©ponse √©tait incorrecte (-1), on affiche la bonne r√©ponse pour le rendu
             selectedAnswer = answeredIndex !== -1 ? answeredIndex : currentQuestion.correct;
        }

        let htmlContent = `
            <div class="mb-6">
                <h2 class="text-xl sm:text-2xl font-semibold text-orange-600 border-b pb-2 mb-4">
                    ${currentComp.competence} (Niveau ${currentComp.level})
                </h2>
                <div class="text-sm text-gray-500 mb-3 flex justify-between">
                    <p>Question ${currentQuestionIndex + 1}/${questionsInComp}</p>
                    <p>Score actuel pour C${currentCompetenceIndex + 1} : <span class="font-bold text-gray-800">${compScore}/5</span></p>
                </div>
                <p class="text-lg font-medium text-gray-900">${currentQuestion.question}</p>
            </div>

            <div class="space-y-3">
                ${currentQuestion.options.map((option, index) => {
                    let buttonClass = 'option-button p-3 border rounded-lg text-left w-full disabled:opacity-100';
                    let icon = '';

                    if (showResult) {
                        if (index === currentQuestion.correct) {
                            // Bonne r√©ponse
                            buttonClass += ' correct border-green-500 font-bold';
                            icon = '<span class="ml-auto text-green-600"><svg class="lucide-check-circle" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><path d="m9 11 3 3L22 4"></path></svg></span>';
                        } else if (index === selectedAnswer && selectedAnswer !== currentQuestion.correct) {
                            // Mauvaise r√©ponse s√©lectionn√©e
                            buttonClass += ' incorrect border-red-500';
                            icon = '<span class="ml-auto text-red-600"><svg class="lucide-x-circle" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="m15 9-6 6"></path><path d="m9 9 6 6"></path></svg></span>';
                        } else {
                            // Autres options non s√©lectionn√©es
                            buttonClass += ' bg-white text-gray-700';
                        }
                    } else {
                        // Pas encore r√©pondu
                        buttonClass += ' bg-white text-gray-700 hover:bg-gray-100';
                    }

                    return `
                        <button 
                            class="${buttonClass}" 
                            onclick="checkAnswer(${index})"
                            ${showResult ? 'disabled' : ''}
                        >
                            <span class="flex items-center justify-between">
                                <span>${option}</span>
                                ${icon}
                            </span>
                        </button>
                    `;
                }).join('')}
            </div>

            ${showResult ? `
                <div class="mt-6 p-4 explanation bg-orange-50 rounded-lg text-gray-700">
                    <p class="font-semibold text-orange-700 mb-1">Explication :</p>
                    <p>${currentQuestion.explanation}</p>
                </div>
            ` : ''}
            
            <div class="mt-8 flex justify-between items-center">
                <button
                    onclick="previousQuestion()"
                    class="flex items-center gap-2 px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors ${currentCompetenceIndex === 0 && currentQuestionIndex === 0 ? 'opacity-50 cursor-not-allowed' : ''}"
                    ${currentCompetenceIndex === 0 && currentQuestionIndex === 0 ? 'disabled' : ''}
                >
                    <svg class="lucide-chevron-left" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg>
                    Pr√©c√©dent
                </button>
                
                ${!showResult ? `
                    <p class="text-sm text-gray-500">S√©lectionnez une option</p>
                ` : `
                    <button
                        onclick="nextQuestion()"
                        class="flex items-center gap-2 px-6 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors"
                    >
                        Suivant
                        <svg class="lucide-chevron-right" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"></path></svg>
                    </button>
                `}
            </div>
            
            ${currentCompetenceIndex === quizData.length - 1 && currentQuestionIndex === questionsInComp - 1 && showResult ? `
                 <div class="mt-8 pt-4 border-t border-gray-200 text-center">
                    <p class="text-xl font-bold text-orange-900 mb-2">
                        Fin du Quiz Interm√©diaire !
                    </p>
                    <button
                        onclick="resetQuiz()"
                        class="flex items-center mx-auto gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"
                    >
                        <svg class="lucide-rotate-ccw" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6H9M10 20l-4-4 4-4"></path><path d="M4 16h13a4 4 0 0 0 0-8h-2"></path></svg>
                        Recommencer tous les quiz
                    </button>
                </div>
            ` : ''}
        `;

        quizCard.innerHTML = htmlContent;
    }

    function changeCompetence(index) {
        currentCompetenceIndex = index;
        currentQuestionIndex = 0;
        selectedAnswer = null;
        showResult = false;
        
        // G√®re l'√©tat des boutons
        competenceButtons.forEach((btn, i) => {
            btn.classList.toggle('active', i === index);
        });

        // Tente de charger la premi√®re question de la comp√©tence
        const answeredIndex = quizState[currentCompetenceIndex].answered[currentQuestionIndex];
        if (answeredIndex !== null) {
            showResult = true;
            selectedAnswer = answeredIndex !== -1 ? answeredIndex : quizData[currentCompetenceIndex].questions[currentQuestionIndex].correct; 
        }

        renderQuiz();
    }
    
    // --- Initialization ---
    competenceButtons.forEach((btn, index) => {
        btn.addEventListener('click', () => changeCompetence(index));
    });

    // Rendu initial
    renderQuiz();
    updateFinalScoreDisplay();
</script>
</body>
</html>
