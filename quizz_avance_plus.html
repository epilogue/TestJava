<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz de Certification Java - Niveau Avanc√© v2 (C1 √† C5)</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom Styles for better visual consistency */
        body {
            background-color: #e5e7eb; /* Gray-100 */
        }
        .container-quiz {
            max-width: 900px;
            margin: 2rem auto;
        }
        .competence-selector {
            background-color: #1f2937; /* Gray-800 */
        }
        .competence-btn.active {
            border-bottom: 3px solid #f97316; /* Orange-500 */
            color: #f97316;
        }
        .option-button {
            transition: all 0.2s;
        }
        .option-button:hover:not(.disabled) {
            background-color: #f3f4f6; /* Gray-100 */
        }
        .option-button.correct {
            background-color: #d1fae5; /* Green-100 */
            border-color: #10b981; /* Green-500 */
            pointer-events: none;
        }
        .option-button.incorrect {
            background-color: #fee2e2; /* Red-100 */
            border-color: #ef4444; /* Red-500 */
            pointer-events: none;
        }
        .explanation {
            border-left: 4px solid #f97316; /* Orange-500 */
        }
        pre {
            background-color: #f3f4f6;
            padding: 1rem;
            border-radius: 0.25rem;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>

<div class="container-quiz p-4">
    <h1 class="text-3xl font-extrabold text-center text-gray-800 mb-4">
        Quiz Avanc√© (v2) - Certification Java (C1 √† C5) üéì
    </h1>
    
    <div class="competence-selector p-3 rounded-t-lg shadow-lg flex flex-wrap justify-center space-x-2 sm:space-x-4">
        <button data-comp="0" class="competence-btn text-white px-3 py-2 text-sm font-medium border-b-3 border-transparent hover:text-orange-300 transition active">C1</button>
        <button data-comp="1" class="competence-btn text-white px-3 py-2 text-sm font-medium border-b-3 border-transparent hover:text-orange-300 transition">C2</button>
        <button data-comp="2" class="competence-btn text-white px-3 py-2 text-sm font-medium border-b-3 border-transparent hover:text-orange-300 transition">C3</button>
        <button data-comp="3" class="competence-btn text-white px-3 py-2 text-sm font-medium border-b-3 border-transparent hover:text-orange-300 transition">C4</button>
        <button data-comp="4" class="competence-btn text-white px-3 py-2 text-sm font-medium border-b-3 border-transparent hover:text-orange-300 transition">C5</button>
    </div>

    <div id="quiz-card" class="bg-white rounded-b-lg shadow-lg p-6 sm:p-8">
        </div>

    <div class="bg-white rounded-lg shadow p-4 text-sm text-gray-600 mt-6">
        <p class="font-semibold mb-2">üìã Informations sur le quiz :</p>
        <ul class="space-y-1">
            <li>‚Ä¢ Niveau de difficult√© : **Avanc√©**</li>
            <li>‚Ä¢ Chaque quiz contient **5 nouvelles questions** (QCM/QCU) sp√©cifiques √† la comp√©tence.</li>
            <li>‚Ä¢ Score cumul√© total : <span id="final-score" class="font-bold text-orange-600"></span></li>
        </ul>
    </div>
</div>

<script>
    const quizData = [
        // --- C1 : √âl√©ments fondamentaux et algorithmie (Avanc√© v2) ---
        {
          competence: "C1 - √âl√©ments fondamentaux et algorithmie",
          level: "Avanc√©",
          questions: [
            {
              question: "Quelle est la diff√©rence entre les op√©rateurs de d√©calage de bits `>>` et `>>>` en Java ?",
              options: [
                "`>>` est un d√©calage arithm√©tique (pr√©serve le signe), `>>>` est un d√©calage logique (remplit avec 0).",
                "`>>` est plus rapide que `>>>`.",
                "`>>>` est un d√©calage arithm√©tique, `>>` est un d√©calage logique.",
                "Ils sont interchangeables pour les nombres positifs."
              ],
              correct: 0,
              explanation: "Le d√©calage arithm√©tique `>>` conserve le bit de signe (le bit le plus √† gauche), tandis que le d√©calage logique non sign√© `>>>` ins√®re toujours un 0, ce qui peut changer le signe d'un nombre n√©gatif."
            },
            {
              question: "Si `String s1 = new String(\"test\");` et `String s2 = s1.intern();`, que retourne `s1 == s2` ?",
              options: [
                "true",
                "false",
                "Le code ne compile pas.",
                "Le r√©sultat est impr√©visible."
              ],
              correct: 1,
              explanation: "La m√©thode `intern()` retourne une r√©f√©rence du pool de cha√Ænes. `s1` est sur le tas, `s2` est dans le pool. Leurs r√©f√©rences m√©moire sont donc diff√©rentes. En revanche, `\"test\" == s2` retournerait `true`."
            },
            {
              question: "Quel est le probl√®me principal avec l'utilisation de `double` ou `float` pour des calculs mon√©taires pr√©cis ?",
              options: [
                "Ils ne peuvent pas stocker de grands nombres.",
                "Ils sont plus lents que les types entiers.",
                "Ils peuvent introduire des erreurs d'arrondi dues √† la repr√©sentation binaire des fractions.",
                "Ils ne g√®rent pas les nombres n√©gatifs."
              ],
              correct: 2,
              explanation: "Les types √† virgule flottante binaire ne peuvent pas repr√©senter exactement toutes les fractions d√©cimales, ce qui entra√Æne des erreurs de pr√©cision. Il faut privil√©gier `BigDecimal` pour les calculs financiers."
            },
            {
              question: "Qu'est-ce qu'une `ArrayStoreException` ?",
              options: [
                "Une erreur qui se produit lorsqu'on essaie d'acc√©der √† un index de tableau hors limites.",
                "Une erreur qui se produit lorsqu'on essaie de stocker un objet d'un type incompatible dans un tableau.",
                "Une erreur lev√©e quand le tableau est `null`.",
                "Une erreur de compilation lors de la d√©claration d'un tableau."
              ],
              correct: 1,
              explanation: "Cette exception d'ex√©cution se produit, par exemple, si vous avez un `Object[] a = new String[1];` et que vous tentez de faire `a[0] = 1;`. Le compilateur l'autorise (covariance des tableaux), mais l'ex√©cution √©choue."
            },
            {
              question: "Que fait une instruction `continue monLabel;` dans des boucles imbriqu√©es ?",
              options: [
                "Elle termine la boucle externe identifi√©e par `monLabel`.",
                "Elle saute l'it√©ration en cours de la boucle la plus interne.",
                "Elle saute √† la prochaine it√©ration de la boucle externe identifi√©e par `monLabel`.",
                "C'est une syntaxe invalide."
              ],
              correct: 2,
              explanation: "Contrairement √† `break label;` qui termine la boucle, `continue label;` saute le reste de l'it√©ration de la boucle externe et continue avec son incr√©mentation et sa prochaine v√©rification."
            }
          ]
        },
        
        // --- C2 : Programmation Orient√©e Objet (Avanc√© v2) ---
        {
          competence: "C2 - Programmation Orient√©e Objet",
          level: "Avanc√©",
          questions: [
            {
              question: "Qu'est-ce que le 'binding dynamique' (dynamic binding) en Java ?",
              options: [
                "La liaison d'une m√©thode au moment de la compilation, bas√©e sur le type de la r√©f√©rence.",
                "La liaison d'une m√©thode au moment de l'ex√©cution, bas√©e sur le type r√©el de l'objet.",
                "La conversion automatique d'un type primitif en son wrapper.",
                "Le processus de chargement d'une classe par la JVM."
              ],
              correct: 1,
              explanation: "Le binding dynamique (ou late binding) est le m√©canisme qui permet au polymorphisme de fonctionner. La JVM d√©termine quelle version d'une m√©thode red√©finie appeler au moment de l'ex√©cution."
            },
            {
              question: "Qu'est-ce qu'un 'type de retour covariant' (covariant return type) ?",
              options: [
                "La capacit√© pour une m√©thode red√©finie de retourner un type parent du type de retour original.",
                "La capacit√© pour une m√©thode red√©finie de retourner un sous-type du type de retour original.",
                "La capacit√© de retourner plusieurs types de donn√©es diff√©rents.",
                "Une m√©thode qui retourne toujours `void`."
              ],
              correct: 1,
              explanation: "Depuis Java 5, une m√©thode red√©finie dans une classe enfant peut retourner un type plus sp√©cifique (un sous-type) que celui d√©clar√© dans la m√©thode de la classe parente."
            },
            {
              question: "Une classe interne non-statique (inner class) peut-elle acc√©der aux membres priv√©s de sa classe externe ?",
              options: [
                "Non, jamais.",
                "Oui, sans restriction.",
                "Uniquement si les membres sont d√©clar√©s `final`.",
                "Uniquement via des getters publics."
              ],
              correct: 1,
              explanation: "Une classe interne non-statique a une r√©f√©rence implicite √† une instance de sa classe externe, ce qui lui donne un acc√®s direct √† tous ses membres, y compris les membres `private`."
            },
            {
              question: "Quel est un cas d'utilisation courant pour un constructeur priv√© (`private`) ?",
              options: [
                "Emp√™cher la classe d'√™tre utilis√©e.",
                "Forcer l'utilisation de m√©thodes `static` pour la cr√©ation d'objets (ex: pattern Singleton ou Factory Method).",
                "Rendre la classe plus s√©curis√©e.",
                "Permettre uniquement aux classes enfants de l'instancier."
              ],
              correct: 1,
              explanation: "Un constructeur priv√© emp√™che l'instanciation directe depuis l'ext√©rieur. C'est la base du pattern Singleton, qui garantit une seule instance, ou des classes utilitaires qui ne doivent pas √™tre instanci√©es."
            },
            {
              question: "Si la classe `A` impl√©mente l'interface `I`, que retourne `new A() instanceof I` ?",
              options: [
                "true",
                "false",
                "Le code ne compile pas car `instanceof` ne fonctionne pas avec les interfaces.",
                "Cela d√©pend de la pr√©sence d'une m√©thode `default` dans l'interface."
              ],
              correct: 0,
              explanation: "L'op√©rateur `instanceof` v√©rifie la relation 'est-un' (is-a). Si une classe impl√©mente une interface, une instance de cette classe est consid√©r√©e comme une instance du type de l'interface."
            }
          ]
        },
        
        // --- C3 : Concepts avanc√©s POO (Avanc√© v2) ---
        {
          competence: "C3 - Concepts avanc√©s POO",
          level: "Avanc√©",
          questions: [
            {
              question: "Une variable locale utilis√©e dans une expression lambda doit √™tre :",
              options: [
                "D√©clar√©e `final`.",
                "Effectivement finale (effectively final).",
                "`static`.",
                "Mutable."
              ],
              correct: 1,
              explanation: "Une variable locale doit √™tre 'effectivement finale', ce qui signifie que sa valeur n'est pas modifi√©e apr√®s son initialisation. Elle n'a pas besoin d'√™tre explicitement d√©clar√©e `final`."
            },
            {
              question: "Que repr√©sente la syntaxe `String::length` ?",
              options: [
                "Un appel direct √† la m√©thode `length`.",
                "Une r√©f√©rence √† une m√©thode d'instance non li√©e (`unbound method reference`).",
                "Une r√©f√©rence √† une m√©thode statique.",
                "Une expression lambda."
              ],
              correct: 1,
              explanation: "C'est une r√©f√©rence de m√©thode qui pointe vers la m√©thode `length()` de la classe `String`. Elle peut √™tre utilis√©e dans un contexte o√π une interface fonctionnelle attend une fonction qui prend un `String` et retourne un `int`."
            },
            {
              question: "Dans quel cas est-il pr√©f√©rable de cr√©er une exception non-v√©rifi√©e (unchecked) plut√¥t qu'une exception v√©rifi√©e (checked) ?",
              options: [
                "Pour les erreurs de programmation (bugs) qui ne devraient pas se produire, comme une violation de pr√©condition.",
                "Pour les erreurs externes r√©cup√©rables, comme un probl√®me de r√©seau.",
                "Pour toutes les erreurs d'entr√©e/sortie.",
                "Il n'y a jamais de bonne raison de pr√©f√©rer une exception non-v√©rifi√©e."
              ],
              correct: 0,
              explanation: "Les exceptions non-v√©rifi√©es (`RuntimeException`) sont id√©ales pour signaler des erreurs de logique interne (bugs) qui ne peuvent pas √™tre raisonnablement g√©r√©es par l'appelant."
            },
            {
              question: "Peut-on ajouter un constructeur et des m√©thodes √† une √©num√©ration (`enum`) en Java ?",
              options: [
                "Non, une √©num√©ration ne peut contenir que des constantes.",
                "Oui, on peut ajouter des constructeurs (qui doivent √™tre priv√©s) et des m√©thodes.",
                "Seulement des m√©thodes statiques.",
                "Seulement des constructeurs publics."
              ],
              correct: 1,
              explanation: "Les √©num√©rations sont des classes √† part enti√®re et peuvent avoir des attributs, des constructeurs (toujours priv√©s ou package-private) et des m√©thodes pour associer des donn√©es et des comportements √† chaque constante."
            },
            {
              question: "Quelle est la principale diff√©rence entre `List.of()` et `new ArrayList<>()` ?",
              options: [
                "`List.of()` cr√©e une liste mutable, `ArrayList` une liste immuable.",
                "`List.of()` est plus ancien et moins performant.",
                "`List.of()` cr√©e une liste immuable (non modifiable), `new ArrayList<>()` cr√©e une liste mutable.",
                "`List.of()` ne peut pas contenir d'√©l√©ments `null`."
              ],
              correct: 2,
              explanation: "Les m√©thodes de fabrique comme `List.of()` (introduites en Java 9) cr√©ent des collections immuables, ce qui les rend s√ªres pour le partage et le multithreading, mais elles ne peuvent pas √™tre modifi√©es apr√®s cr√©ation."
            }
          ]
        },
        
        // --- C4 : Collections, Streams et API de dates (Avanc√© v2) ---
        {
          competence: "C4 - Collections, Streams et API de dates",
          level: "Avanc√©",
          questions: [
            {
              question: "Dans l'API Stream, que fait `collect(Collectors.groupingBy(...))` ?",
              options: [
                "Regroupe les √©l√©ments en une seule cha√Æne de caract√®res.",
                "Trie les √©l√©ments du stream.",
                "Partitionne le stream en deux listes (vrai/faux).",
                "Regroupe les √©l√©ments en une `Map` o√π les cl√©s sont le r√©sultat d'une fonction de classification."
              ],
              correct: 3,
              explanation: "`groupingBy` est un collecteur puissant pour effectuer des op√©rations similaires au `GROUP BY` de SQL, en organisant les √©l√©ments en cat√©gories."
            },
            {
              question: "Consid√©rez `Optional<String> opt;`. Quelle est la diff√©rence entre `opt.map(String::toUpperCase)` et `opt.flatMap(s -> Optional.of(s.toUpperCase()))` ?",
              options: [
                "`map` retourne `Optional<Optional<String>>`, `flatMap` retourne `Optional<String>`.",
                "`flatMap` retourne `Optional<Optional<String>>`, `map` retourne `Optional<String>`.",
                "Il n'y a aucune diff√©rence, le r√©sultat est le m√™me.",
                "`flatMap` est utilis√© uniquement si la fonction de mapping peut retourner `null`."
              ],
              correct: 0,
              explanation: "Le r√¥le de `flatMap` sur un `Optional` est d'appliquer une fonction qui retourne d√©j√† un `Optional`, puis d'aplatir le r√©sultat pour √©viter d'obtenir un `Optional` imbriqu√©."
            },
            {
              question: "Comment peut-on cr√©er un `Stream` parall√®le √† partir d'une `List` ?",
              options: [
                "En utilisant `new ParallelStream(list)`.",
                "En appelant `list.parallelStream()`.",
                "En appelant `list.stream().parallel()`.",
                "Les r√©ponses B et C sont toutes les deux correctes."
              ],
              correct: 3,
              explanation: "On peut soit obtenir un stream parall√®le directement avec `parallelStream()`, soit convertir un stream s√©quentiel existant en parall√®le avec `parallel()`. Les deux approches sont valides."
            },
            {
              question: "Quelle classe de `java.time` est la plus appropri√©e pour repr√©senter un d√©calage horaire par rapport √† l'UTC, comme `+02:00` ?",
              options: [
                "`ZoneId`",
                "`ZoneOffset`",
                "`ZonedDateTime`",
                "`Period`"
              ],
              correct: 1,
              explanation: "`ZoneOffset` repr√©sente un d√©calage fixe par rapport √† l'UTC, tandis que `ZoneId` repr√©sente des r√®gles de fuseau horaire plus complexes (comme 'Europe/Paris') qui tiennent compte de l'heure d'√©t√©."
            },
            {
              question: "Quelle est la diff√©rence entre un `reduce` avec une identit√© et un `reduce` sans identit√© dans l'API Stream ?",
              options: [
                "Le `reduce` avec identit√© retourne un `Optional`, celui sans identit√© retourne directement la valeur.",
                "Le `reduce` sans identit√© retourne un `Optional`, celui avec identit√© retourne directement la valeur.",
                "Le `reduce` avec identit√© ne peut √™tre utilis√© que sur des streams de nombres.",
                "Il n'y a pas de `reduce` sans identit√©."
              ],
              correct: 1,
              explanation: "Si le stream est vide, le `reduce` sans identit√© n'a pas de valeur √† retourner, il renvoie donc un `Optional.empty()`. Le `reduce` avec une valeur d'identit√© peut retourner cette identit√©, donc il renvoie directement le type d'objet."
            }
          ]
        },
        
        // --- C5 : Connexion √† une base de donn√©es avec JDBC (Avanc√© v2) ---
        {
          competence: "C5 - Connexion √† une base de donn√©es avec JDBC",
          level: "Avanc√©",
          questions: [
            {
              question: "Quel est l'avantage principal d'utiliser une `DataSource` plut√¥t que `DriverManager` pour obtenir des connexions ?",
              options: [
                "C'est la seule fa√ßon d'utiliser des transactions.",
                "Cela permet une configuration centralis√©e et la mise en commun des connexions (connection pooling).",
                "C'est plus s√©curis√© car cela chiffre toujours les mots de passe.",
                "C'est une API plus ancienne et plus stable."
              ],
              correct: 1,
              explanation: "Une `DataSource` abstrait les d√©tails de la connexion et est la base pour des fonctionnalit√©s avanc√©es comme le pooling, qui r√©utilise les connexions pour am√©liorer consid√©rablement les performances."
            },
            {
              question: "Comment un `CallableStatement` g√®re-t-il un param√®tre de sortie (OUT parameter) d'une proc√©dure stock√©e ?",
              options: [
                "Il le retourne directement via la m√©thode `execute()`.",
                "Il faut d'abord l'enregistrer avec `registerOutParameter()`, puis le r√©cup√©rer apr√®s ex√©cution.",
                "Les param√®tres de sortie sont automatiquement mapp√©s sur des variables locales.",
                "Ce n'est pas possible, JDBC ne g√®re que les param√®tres d'entr√©e."
              ],
              correct: 1,
              explanation: "Pour les param√®tres de sortie, il faut indiquer √† JDBC leur type avant l'ex√©cution avec `registerOutParameter()`, puis utiliser les m√©thodes `get...()` correspondantes pour lire leur valeur apr√®s l'appel."
            },
            {
              question: "Qu'est-ce qu'un `ResultSet` de type `TYPE_SCROLL_SENSITIVE` ?",
              options: [
                "Un `ResultSet` qui est insensible aux changements faits par d'autres transactions.",
                "Un `ResultSet` qui peut voir les mises √† jour, insertions et suppressions faites par d'autres transactions.",
                "Un `ResultSet` qui ne peut √™tre parcouru qu'en avant.",
                "Un `ResultSet` qui est sensible √† la casse (case-sensitive) pour les noms de colonnes."
              ],
              correct: 1,
              explanation: "Un `ResultSet` sensible au d√©filement tente de refl√©ter les changements effectu√©s sur les donn√©es sous-jacentes par d'autres transactions apr√®s sa cr√©ation, bien que le support d√©pende du driver JDBC."
            },
            {
              question: "Que signifie un `BatchUpdateException` ?",
              options: [
                "Toutes les commandes du lot ont √©chou√©.",
                "La connexion √† la base de donn√©es a √©t√© perdue pendant le traitement par lot.",
                "Au moins une des commandes dans un traitement par lot a √©chou√©.",
                "Le lot contenait trop de commandes."
              ],
              correct: 2,
              explanation: "Cette exception est lev√©e lorsque `executeBatch()` √©choue. Elle contient des informations sur le nombre de commandes qui ont r√©ussi avant l'√©chec, permettant une gestion d'erreur plus fine."
            },
            {
              question: "Quel niveau d'isolation de transaction emp√™che les 'lectures sales' (dirty reads) mais autorise les 'lectures non reproductibles' (non-repeatable reads) ?",
              options: [
                "`TRANSACTION_READ_UNCOMMITTED`",
                "`TRANSACTION_READ_COMMITTED`",
                "`TRANSACTION_REPEATABLE_READ`",
                "`TRANSACTION_SERIALIZABLE`"
              ],
              correct: 1,
              explanation: "`READ_COMMITTED` garantit qu'une transaction ne lit que des donn√©es qui ont √©t√© valid√©es (commit), √©vitant les lectures sales. Cependant, si elle relit les m√™mes donn√©es, elles peuvent avoir √©t√© modifi√©es par une autre transaction entre-temps."
            }
          ]
        }
    ];

    let currentCompetenceIndex = 0;
    let currentQuestionIndex = 0;
    let selectedAnswer = null;
    let showResult = false;
    // Stockage du score et des r√©ponses par comp√©tence: [score, reponse_index_selectionn√©_par_question]
    let quizState = quizData.map(comp => ({
        score: 0,
        answered: Array(comp.questions.length).fill(null), // null: non r√©pondu, -1: r√©ponse incorrecte, index: r√©ponse correcte
        isCompleted: false
    }));

    const quizCard = document.getElementById('quiz-card');
    const competenceButtons = document.querySelectorAll('.competence-btn');
    const finalScoreDisplay = document.getElementById('final-score');

    const TOTAL_QUESTIONS = quizData.reduce((sum, comp) => sum + comp.questions.length, 0);

    // --- Core Logic ---

    function updateFinalScoreDisplay() {
        const totalScore = quizState.reduce((sum, state) => sum + state.score, 0);
        finalScoreDisplay.textContent = `${totalScore}/${TOTAL_QUESTIONS} (${Math.round((totalScore / TOTAL_QUESTIONS) * 100)}%)`;
    }

    function checkAnswer(selectedIndex) {
        if (showResult) return; // Emp√™che de r√©pondre deux fois

        const currentCompState = quizState[currentCompetenceIndex];
        const currentQuestion = quizData[currentCompetenceIndex].questions[currentQuestionIndex];
        
        selectedAnswer = selectedIndex;
        showResult = true;

        // Mise √† jour de l'√©tat (score et r√©ponse)
        if (selectedIndex === currentQuestion.correct) {
            currentCompState.score++;
            currentCompState.answered[currentQuestionIndex] = selectedIndex; // Stocke l'index de la r√©ponse correcte
        } else {
             currentCompState.answered[currentQuestionIndex] = -1; // -1 pour incorrect
        }
        
        if (currentQuestionIndex === quizData[currentCompetenceIndex].questions.length - 1) {
            currentCompState.isCompleted = true;
        }

        renderQuiz();
        updateFinalScoreDisplay();
    }

    function nextQuestion() {
        showResult = false;
        selectedAnswer = null;
        
        const questionsInComp = quizData[currentCompetenceIndex].questions.length;

        if (currentQuestionIndex < questionsInComp - 1) {
            // Passer √† la question suivante dans la m√™me comp√©tence
            currentQuestionIndex++;
        } else {
            // Passer √† la comp√©tence suivante si la question actuelle est la derni√®re
            if (currentCompetenceIndex < quizData.length - 1) {
                currentCompetenceIndex++;
                currentQuestionIndex = 0;
                // Met √† jour l'√©tat des boutons de comp√©tence
                competenceButtons.forEach(btn => btn.classList.remove('active'));
                competenceButtons[currentCompetenceIndex].classList.add('active');
            } else {
                // Quiz enti√®rement termin√©
                return;
            }
        }
        renderQuiz();
    }
    
    function previousQuestion() {
        showResult = false;
        selectedAnswer = null;
        
        if (currentQuestionIndex > 0) {
            // Revenir √† la question pr√©c√©dente dans la m√™me comp√©tence
            currentQuestionIndex--;
        } else {
            // Revenir √† la comp√©tence pr√©c√©dente
            if (currentCompetenceIndex > 0) {
                currentCompetenceIndex--;
                currentQuestionIndex = quizData[currentCompetenceIndex].questions.length - 1;
                // Met √† jour l'√©tat des boutons de comp√©tence
                competenceButtons.forEach(btn => btn.classList.remove('active'));
                competenceButtons[currentCompetenceIndex].classList.add('active');
            } else {
                // Premi√®re question de la premi√®re comp√©tence
                return;
            }
        }
        
        // Si on revient √† une question d√©j√† r√©pondue, afficher la r√©ponse enregistr√©e
        const answeredState = quizState[currentCompetenceIndex].answered[currentQuestionIndex];
        if (answeredState !== null) {
            showResult = true;
            // Si la r√©ponse √©tait correcte, selectedAnswer doit √™tre l'index correct pour le rendu
            selectedAnswer = answeredState !== -1 ? answeredState : quizData[currentCompetenceIndex].questions[currentQuestionIndex].correct; 
        }

        renderQuiz();
    }

    function resetQuiz() {
        quizState = quizData.map(comp => ({
            score: 0,
            answered: Array(comp.questions.length).fill(null),
            isCompleted: false
        }));
        currentCompetenceIndex = 0;
        currentQuestionIndex = 0;
        selectedAnswer = null;
        showResult = false;
        competenceButtons.forEach(btn => btn.classList.remove('active'));
        competenceButtons[0].classList.add('active');
        renderQuiz();
        updateFinalScoreDisplay();
    }


    // --- Rendering Logic (HTML Generation) ---

    function renderQuiz() {
        const currentComp = quizData[currentCompetenceIndex];
        const currentQuestion = currentComp.questions[currentQuestionIndex];
        const questionsInComp = currentComp.questions.length;
        const compScore = quizState[currentCompetenceIndex].score;
        
        // V√©rifie si la question a √©t√© r√©pondue pour restaurer l'√©tat
        const answeredIndex = quizState[currentCompetenceIndex].answered[currentQuestionIndex];
        const isAnswered = answeredIndex !== null;
        
        if (isAnswered && !showResult) {
             showResult = true;
             // Si la r√©ponse √©tait incorrecte (-1), on affiche la bonne r√©ponse pour le rendu
             selectedAnswer = answeredIndex !== -1 ? answeredIndex : currentQuestion.correct;
        }

        let htmlContent = `
            <div class="mb-6">
                <h2 class="text-xl sm:text-2xl font-semibold text-orange-600 border-b pb-2 mb-4">
                    ${currentComp.competence} (Niveau ${currentComp.level})
                </h2>
                <div class="text-sm text-gray-500 mb-3 flex justify-between">
                    <p>Question ${currentQuestionIndex + 1}/${questionsInComp}</p>
                    <p>Score actuel pour C${currentCompetenceIndex + 1} : <span class="font-bold text-gray-800">${compScore}/5</span></p>
                </div>
                <div class="text-lg font-medium text-gray-900">${currentQuestion.question.includes('`') ? `<pre>${currentQuestion.question.replace(/`/g, '')}</pre>` : `<p>${currentQuestion.question}</p>`}</div>
            </div>

            <div class="space-y-3">
                ${currentQuestion.options.map((option, index) => {
                    let buttonClass = 'option-button p-3 border rounded-lg text-left w-full disabled:opacity-100';
                    let icon = '';

                    if (showResult) {
                        if (index === currentQuestion.correct) {
                            // Bonne r√©ponse
                            buttonClass += ' correct border-green-500 font-bold';
                            icon = '<span class="ml-auto text-green-600"><svg class="lucide-check-circle" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><path d="m9 11 3 3L22 4"></path></svg></span>';
                        } else if (index === selectedAnswer && selectedAnswer !== currentQuestion.correct) {
                            // Mauvaise r√©ponse s√©lectionn√©e
                            buttonClass += ' incorrect border-red-500';
                            icon = '<span class="ml-auto text-red-600"><svg class="lucide-x-circle" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="m15 9-6 6"></path><path d="m9 9 6 6"></path></svg></span>';
                        } else {
                            // Autres options non s√©lectionn√©es
                            buttonClass += ' bg-white text-gray-700';
                        }
                    } else {
                        // Pas encore r√©pondu
                        buttonClass += ' bg-white text-gray-700 hover:bg-gray-100';
                    }

                    return `
                        <button 
                            class="${buttonClass}" 
                            onclick="checkAnswer(${index})"
                            ${showResult ? 'disabled' : ''}
                        >
                            <span class="flex items-center justify-between">
                                <span>${option.includes('`') ? `<code>${option.replace(/`/g, '')}</code>` : option}</span>
                                ${icon}
                            </span>
                        </button>
                    `;
                }).join('')}
            </div>

            ${showResult ? `
                <div class="mt-6 p-4 explanation bg-orange-50 rounded-lg text-gray-700">
                    <p class="font-semibold text-orange-700 mb-1">Explication :</p>
                    <p>${currentQuestion.explanation}</p>
                </div>
            ` : ''}
            
            <div class="mt-8 flex justify-between items-center">
                <button
                    onclick="previousQuestion()"
                    class="flex items-center gap-2 px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors ${currentCompetenceIndex === 0 && currentQuestionIndex === 0 ? 'opacity-50 cursor-not-allowed' : ''}"
                    ${currentCompetenceIndex === 0 && currentQuestionIndex === 0 ? 'disabled' : ''}
                >
                    <svg class="lucide-chevron-left" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg>
                    Pr√©c√©dent
                </button>
                
                ${!showResult ? `
                    <p class="text-sm text-gray-500">S√©lectionnez une option</p>
                ` : `
                    <button
                        onclick="nextQuestion()"
                        class="flex items-center gap-2 px-6 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors"
                    >
                        Suivant
                        <svg class="lucide-chevron-right" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"></path></svg>
                    </button>
                `}
            </div>
            
            ${currentCompetenceIndex === quizData.length - 1 && currentQuestionIndex === questionsInComp - 1 && showResult ? `
                 <div class="mt-8 pt-4 border-t border-gray-200 text-center">
                    <p class="text-xl font-bold text-orange-900 mb-2">
                        Fin du Quiz Avanc√© !
                    </p>
                    <button
                        onclick="resetQuiz()"
                        class="flex items-center mx-auto gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"
                    >
                        <svg class="lucide-rotate-ccw" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6H9M10 20l-4-4 4-4"></path><path d="M4 16h13a4 4 0 0 0 0-8h-2"></path></svg>
                        Recommencer tous les quiz
                    </button>
                </div>
            ` : ''}
        `;

        quizCard.innerHTML = htmlContent;
    }

    function changeCompetence(index) {
        currentCompetenceIndex = index;
        currentQuestionIndex = 0;
        selectedAnswer = null;
        showResult = false;
        
        // G√®re l'√©tat des boutons
        competenceButtons.forEach((btn, i) => {
            btn.classList.toggle('active', i === index);
        });

        // Tente de charger la premi√®re question de la comp√©tence
        const answeredIndex = quizState[currentCompetenceIndex].answered[currentQuestionIndex];
        if (answeredIndex !== null) {
            showResult = true;
            selectedAnswer = answeredIndex !== -1 ? answeredIndex : quizData[currentCompetenceIndex].questions[currentQuestionIndex].correct; 
        }

        renderQuiz();
    }
    
    // --- Initialization ---
    competenceButtons.forEach((btn, index) => {
        btn.addEventListener('click', () => changeCompetence(index));
    });

    // Rendu initial
    renderQuiz();
    updateFinalScoreDisplay();
</script>
</body>
</html>
